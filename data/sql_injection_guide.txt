SQL-–ò–ù–™–ï–ö–¶–ò–ò: –û–ü–ê–°–ù–û–°–¢–¨, –ü–†–ò–ú–ï–†–´ –ò –ó–ê–©–ò–¢–ê

–û–ü–ò–°–ê–ù–ò–ï  
SQL-–∏–Ω—ä–µ–∫—Ü–∏—è (CWE-89) –≤–æ–∑–Ω–∏–∫–∞–µ—Ç, –∫–æ–≥–¥–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –Ω–µ–¥–æ–≤–µ—Ä–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –≤ SQL-–∑–∞–ø—Ä–æ—Å –±–µ–∑ –Ω–∞–¥–ª–µ–∂–∞—â–µ–π –Ω–µ–π—Ç—Ä–∞–ª–∏–∑–∞—Ü–∏–∏. –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –∞—Ç–∞–∫—É—é—â–µ–º—É:
- –ß–∏—Ç–∞—Ç—å/–∏–∑–º–µ–Ω—è—Ç—å/—É–¥–∞–ª—è—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î
- –û–±—Ö–æ–¥–∏—Ç—å –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—é
- –í—ã–ø–æ–ª–Ω—è—Ç—å –∫–æ–º–∞–Ω–¥—ã –û–° (–≤ –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö –°–£–ë–î)
- –ü–æ–ª—É—á–∏—Ç—å –ø–æ–ª–Ω—ã–π –∫–æ–Ω—Ç—Ä–æ–ª—å –Ω–∞–¥ —Å–µ—Ä–≤–µ—Ä–æ–º

–¢–ò–ü–ò–ß–ù–´–ï –°–¶–ï–ù–ê–†–ò–ò –ê–¢–ê–ö–ò  
‚Ä¢ –í—Ö–æ–¥ –≤ –∞–¥–º–∏–Ω–∫—É –±–µ–∑ –ø–∞—Ä–æ–ª—è: `' OR '1'='1`  
‚Ä¢ –ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –¥—Ä—É–≥–∏—Ö —Ç–∞–±–ª–∏—Ü: `' UNION SELECT credit_card FROM users--`  
‚Ä¢ –ó–∞–ø–∏—Å—å –≤–µ–±-—à–µ–ª–ª–∞ —á–µ—Ä–µ–∑ INTO OUTFILE (MySQL)  
‚Ä¢ –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ xp_cmdshell (MS SQL Server)

---

–£–Ø–ó–í–ò–ú–´–ï –ü–ê–¢–¢–ï–†–ù–´ –ö–û–î–ê –ü–û –Ø–ó–´–ö–ê–ú

üêç **Python**

–£—è–∑–≤–∏–º–æ (–∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è —Å—Ç—Ä–æ–∫):  
  query = "SELECT * FROM users WHERE name = '" + username + "'"
  cursor.execute(query)

–£—è–∑–≤–∏–º–æ (—Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ f-—Å—Ç—Ä–æ–∫–æ–π):  
  cursor.execute(f"SELECT * FROM users WHERE id = {user_id}")

–ë–µ–∑–æ–ø–∞—Å–Ω–æ (–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å):  
  cursor.execute("SELECT * FROM users WHERE name = %s", (username,))
  # –ò–ª–∏ —Å –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏:
  cursor.execute("SELECT * FROM users WHERE id = %(id)s", {"id": user_id})

‚ö†Ô∏è ORM (SQLAlchemy) ‚Äî –±–µ–∑–æ–ø–∞—Å–µ–Ω –¢–û–õ–¨–ö–û –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤:  
  –£—è–∑–≤–∏–º–æ: session.execute(text(f"SELECT * FROM users WHERE name = '{name}'"))  
  –ë–µ–∑–æ–ø–∞—Å–Ω–æ: session.execute(select(User).where(User.name == name))

---

‚òï **Java**

–£—è–∑–≤–∏–º–æ (Statement):  
  String query = "SELECT * FROM products WHERE id = " + userInput;
  Statement stmt = connection.createStatement();
  ResultSet rs = stmt.executeQuery(query);

–ë–µ–∑–æ–ø–∞—Å–Ω–æ (PreparedStatement):  
  String query = "SELECT * FROM products WHERE id = ?";
  PreparedStatement pstmt = connection.prepareStatement(query);
  pstmt.setString(1, userInput);
  ResultSet rs = pstmt.executeQuery();

‚ö†Ô∏è Hibernate HQL/JPA ‚Äî —É—è–∑–≤–∏–º –ø—Ä–∏ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏:  
  –£—è–∑–≤–∏–º–æ: entityManager.createQuery("FROM User u WHERE u.name = '" + name + "'");
  –ë–µ–∑–æ–ø–∞—Å–Ω–æ: entityManager.createQuery("FROM User u WHERE u.name = :name").setParameter("name", name);

---

üåê **JavaScript / Node.js**

–£—è–∑–≤–∏–º–æ (mysql2 –±–µ–∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤):  
  const query = `SELECT * FROM users WHERE email = '${email}'`;
  connection.execute(query);

–ë–µ–∑–æ–ø–∞—Å–Ω–æ (–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å):  
  connection.execute('SELECT * FROM users WHERE email = ?', [email]);

–î–ª—è PostgreSQL (pg):  
  –£—è–∑–≤–∏–º–æ: `client.query("SELECT * FROM users WHERE id = " + id);`  
  –ë–µ–∑–æ–ø–∞—Å–Ω–æ: `client.query('SELECT * FROM users WHERE id = $1', [id]);`

‚ö†Ô∏è Sequelize ORM ‚Äî –±–µ–∑–æ–ø–∞—Å–µ–Ω –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ –æ–±—ä–µ–∫—Ç–æ–≤:  
  –£—è–∑–≤–∏–º–æ: User.findAll({ where: { name: `' OR '1'='1` } }) ‚Äî –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –Ω–µ –≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è  
  –ë–µ–∑–æ–ø–∞—Å–Ω–æ: Sequelize –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç –∑–Ω–∞—á–µ–Ω–∏—è –ø—Ä–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏.

---

üêò **PHP**

–£—è–∑–≤–∏–º–æ (mysqli –±–µ–∑ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω—ã—Ö –≤—ã—Ä–∞–∂–µ–Ω–∏–π):  
  $query = "SELECT * FROM users WHERE name = '" . $_GET['name'] . "'";
  mysqli_query($conn, $query);

–ë–µ–∑–æ–ø–∞—Å–Ω–æ (Prepared Statements):  
  $stmt = $mysqli->prepare("SELECT * FROM users WHERE name = ?");
  $stmt->bind_param("s", $_GET['name']);
  $stmt->execute();

–î–ª—è PDO:  
  –£—è–∑–≤–∏–º–æ: $pdo->query("SELECT * FROM users WHERE id = " . $_POST['id']);  
  –ë–µ–∑–æ–ø–∞—Å–Ω–æ:  
    $stmt = $pdo->prepare("SELECT * FROM users WHERE id = :id");
    $stmt->bindParam(':id', $_POST['id']);
    $stmt->execute();

---

üêπ **Go**

–£—è–∑–≤–∏–º–æ (–∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏—è):  
  query := fmt.Sprintf("SELECT * FROM users WHERE id = %s", userID)
  db.Query(query)

–ë–µ–∑–æ–ø–∞—Å–Ω–æ (–ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å):  
  db.Query("SELECT * FROM users WHERE id = ?", userID)

‚ö†Ô∏è database/sql –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —ç–∫—Ä–∞–Ω–∏—Ä—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ placeholder'–æ–≤ (`?`, `$1` –∏ —Ç.–¥.).

---

–ß–ï–ì–û –ù–ï–õ–¨–ó–Ø –î–ï–õ–ê–¢–¨

‚ùå **–≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞—Ç—å –≤—Ä—É—á–Ω—É—é**  
  –ü—Ä–∏–º–µ—Ä: –∑–∞–º–µ–Ω–∞ `'` –Ω–∞ `''` –∏–ª–∏ `\'`  
  ‚Äî –ù–µ –Ω–∞–¥—ë–∂–Ω–æ! –°—É—â–µ—Å—Ç–≤—É—é—Ç –æ–±—Ö–æ–¥—ã —á–µ—Ä–µ–∑ –∫–æ–¥–∏—Ä–æ–≤–∫–∏, –º—É–ª—å—Ç–∏–±–∞–π—Ç–æ–≤—ã–µ —Å–∏–º–≤–æ–ª—ã, –¥—Ä—É–≥–∏–µ –∫–∞–≤—ã—á–∫–∏.

‚ùå **–ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å "blacklist"-—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é**  
  –ü—Ä–∏–º–µ—Ä: –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å —Å–ª–æ–≤–∞ `SELECT`, `UNION`, `--`  
  ‚Äî –õ–µ–≥–∫–æ –æ–±—Ö–æ–¥–∏—Ç—Å—è: `SELSELECTECT`, `UNIunionON`, `#`, `/*`, URL-–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ.

‚ùå **–ü–æ–ª–∞–≥–∞—Ç—å—Å—è –Ω–∞ —Ç–∏–ø–∏–∑–∞—Ü–∏—é (–Ω–∞–ø—Ä–∏–º–µ—Ä, "id ‚Äî —á–∏—Å–ª–æ, –∑–Ω–∞—á–∏—Ç, –±–µ–∑–æ–ø–∞—Å–Ω–æ")**  
  ‚Äî –ï—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–∏—Ö–æ–¥–∏—Ç –∫–∞–∫ —Å—Ç—Ä–æ–∫–∞ –∏ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∏—Ä—É–µ—Ç—Å—è ‚Äî —É—è–∑–≤–∏–º–æ.  
  ‚Äî –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã, –¥–∞–∂–µ –¥–ª—è —á–∏—Å–µ–ª.

‚ùå **–î—É–º–∞—Ç—å, —á—Ç–æ ORM –ø–æ–ª–Ω–æ—Å—Ç—å—é –∑–∞—â–∏—â–∞–µ—Ç**  
  ‚Äî ORM —É—è–∑–≤–∏–º—ã –ø—Ä–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–∏ "raw queries" –∏–ª–∏ –∫–æ–Ω–∫–∞—Ç–µ–Ω–∞—Ü–∏–∏ —Å—Ç—Ä–æ–∫ –≤–Ω—É—Ç—Ä–∏ ORM.

---

–ù–ê–î–ï–ñ–ù–´–ï –ú–ï–¢–û–î–´ –ó–ê–©–ò–¢–´

‚úÖ **1. –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã (Prepared Statements)**  
   ‚Äî –ì–ª–∞–≤–Ω—ã–π –∏ –Ω–∞–∏–±–æ–ª–µ–µ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π –º–µ—Ç–æ–¥.  
   ‚Äî –†–∞–±–æ—Ç–∞–µ—Ç –≤–æ –≤—Å–µ—Ö —è–∑—ã–∫–∞—Ö –∏ –°–£–ë–î.  
   ‚Äî –î–∞–Ω–Ω—ã–µ –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ –æ—Ç –ª–æ–≥–∏–∫–∏ –∑–∞–ø—Ä–æ—Å–∞ ‚Äî –°–£–ë–î –Ω–µ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∏—Ä—É–µ—Ç –∏—Ö –∫–∞–∫ SQL.

‚úÖ **2. –ü—Ä–∏–Ω—Ü–∏–ø –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π –¥–ª—è –ë–î**  
   ‚Äî –£—á—ë—Ç–Ω–∞—è –∑–∞–ø–∏—Å—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –Ω–µ –¥–æ–ª–∂–Ω–∞ –∏–º–µ—Ç—å –ø—Ä–∞–≤:  
     ‚Ä¢ DROP, CREATE, ALTER  
     ‚Ä¢ EXECUTE (–¥–ª—è —Ö—Ä–∞–Ω–∏–º—ã—Ö –ø—Ä–æ—Ü–µ–¥—É—Ä)  
     ‚Ä¢ FILE (–≤ MySQL)  
   ‚Äî –û–≥—Ä–∞–Ω–∏—á—å—Ç–µ –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –∫ –Ω—É–∂–Ω—ã–º —Ç–∞–±–ª–∏—Ü–∞–º.

‚úÖ **3. –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Ö–æ–¥–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö**  
   ‚Äî –î–ª—è —á–∏—Å–µ–ª: –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–∏–ø –∏ –¥–∏–∞–ø–∞–∑–æ–Ω.  
   ‚Äî –î–ª—è —Å—Ç—Ä–æ–∫: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –±–µ–ª—ã–µ —Å–ø–∏—Å–∫–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Ç–æ–ª—å–∫–æ –±—É–∫–≤—ã/—Ü–∏—Ñ—Ä—ã).  
   ‚Äî –ù–æ –ø–æ–º–Ω–∏—Ç–µ: –≤–∞–ª–∏–¥–∞—Ü–∏—è ‚Äî –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ, –∞ –Ω–µ –∑–∞–º–µ–Ω–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏–∏.

‚úÖ **4. –≠–∫—Ä–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞)**  
   ‚Äî –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –°–£–ë–î:  
     ‚Ä¢ MySQL: `mysql_real_escape_string()` (PHP)  
     ‚Ä¢ PostgreSQL: `PQescapeString()`  
   ‚Äî –ù–µ —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è ‚Äî –ø–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è –≤—Å–µ–≥–¥–∞ –ø—Ä–µ–¥–ø–æ—á—Ç–∏—Ç–µ–ª—å–Ω–µ–µ.

‚úÖ **5. Web Application Firewall (WAF)**  
   ‚Äî –ú–æ–∂–µ—Ç –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å –∏–∑–≤–µ—Å—Ç–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã SQLi.  
   ‚Äî –ù–µ –∑–∞–º–µ–Ω—è–µ—Ç –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–æ–¥–∞ ‚Äî –ª–µ–≥–∫–æ –æ–±—Ö–æ–¥–∏—Ç—Å—è.

---

–î–û–ü–û–õ–ù–ò–¢–ï–õ–¨–ù–´–ï –†–ï–°–£–†–°–´

‚Ä¢ OWASP SQL Injection Prevention Cheat Sheet:  
  https://cheatsheetseries.owasp.org/cheatsheets/SQL_Injection_Prevention_Cheat_Sheet.html

‚Ä¢ CWE-89:  
  https://cwe.mitre.org/data/definitions/89.html

‚Ä¢ PortSwigger SQL Injection Academy (–∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–µ –ª–∞–±–æ—Ä–∞—Ç–æ—Ä–∏–∏):  
  https://portswigger.net/web-security/sql-injection

‚Ä¢ SQL Injection Payload List (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è):  
  https://github.com/payloadbox/sql-injection-payload-list

---

–ü–†–ò–ú–ï–† –£–°–ü–ï–®–ù–û–ô –ó–ê–©–ò–¢–´

‚ùå –ë—ã–ª–æ:  
  query = "SELECT * FROM accounts WHERE user_id = " + request.form['id']

‚úÖ –°—Ç–∞–ª–æ:  
  query = "SELECT * FROM accounts WHERE user_id = %s"
  cursor.execute(query, (request.form['id'],))

–†–µ–∑—É–ª—å—Ç–∞—Ç: –¥–∞–∂–µ –ø—Ä–∏ –≤–≤–æ–¥–µ `1; DROP TABLE accounts--` –∑–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–∏—Ç—Å—è –∫–∞–∫ –ø–æ–∏—Å–∫ –ø–æ ID = "1; DROP TABLE accounts--", –∞ –Ω–µ –∫–∞–∫ –¥–≤–∞ –æ—Ç–¥–µ–ª—å–Ω—ã—Ö SQL-–æ–ø–µ—Ä–∞—Ç–æ—Ä–∞.